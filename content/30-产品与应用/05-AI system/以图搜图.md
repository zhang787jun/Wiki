---
title: "以图搜图部署"
layout: page
date: 2099-06-02 00:00
---

[TOC]




```yaml
apiVersion: v1       
kind: Deployment         
metadata:	                
  name: image_search-deployment  #Deployment 的名称
  labels:	                #标签，可以灵活定位一个或多个资源，其中key和value均可自定义，可以定义多组，目前不需要理解
    app: image_search	#为该Deployment设置key为app，value为nginx的标签
spec:	        
  replicas: 1	#使用该Deployment创建一个应用程序实例
  selector:	    #标签选择器，与上面的标签共同作用，目前不需要理解
    matchLabels: #选择包含标签app:nginx的资源
      app: image_search
    spec:	    #期望Pod实现的功能（即在pod中部署）
      containers:	#生成container，与docker中的container是同一种
      - name: zilliz_search_images_demo	
        image: ilvusbootcamp/pic-search-webserver:0.10.0
        type: NodePort	
        ports: 
            - name: web-port                   #端口号名称
            containerPort: 5000              #容器需要监听的端口号
            hostPort: 35000
        envs:
            - name: DATA_PATH
            value: /tmp/images-data
            - name: MILVUS_HOST
            value: ${MILVUS_IP}
    volumes:                    #在该pod上定义共享存储卷列表
    - name: volume-1              #共享存储卷名称 （volumes类型有很多种）
      hostPath: ${IMAGE_PATH2}         #类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录
        path: /tmp/pic2           #Pod所在宿主机的目录，将被用于同期中mount的目录
    - name: volume-2              #共享存储卷名称 （volumes类型有很多种）
      hostPath: ${IMAGE_PATH2}       #类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录
        path: /tmp/pic2           #Pod所在宿主机的目录，将被用于同期中mount的目录
    volumeMounts:                      #挂载到容器内部的存储卷配置
    - name: string1                     #
      mountPath: string               #存储卷在容器内mount的绝对路径，应少于512字符
      readOnly: false               #是否为只读模式

  replicas: 1	#使用该Deployment创建一个应用程序实例
  selector:	    #标签选择器，与上面的标签共同作用，目前不需要理解
    matchLabels: #选择包含标签app:nginx的资源
      app: image_search
    spec:	    #期望Pod实现的功能（即在pod中部署）
      containers:	#生成container，与docker中的container是同一种
      - name: zilliz_search_images_demo_web	
        image: milvusbootcamp/pic-search-webclient:0.2.0
        type: NodePort
        ports: 
            - name: web-port                   #端口号名称
            containerPort: 80             #容器需要监听的端口号
            hostPort: 21080
        envs:
            - name: WEBSERVER_IP
            value: WEBSERVER_IP
            - name: API_URL
            value: http://${WEBSERVER_IP}:35000
            
apiVersion: v1
kind: Service
metadata:
  name: my-image-search
  namespace: image-search
  resourceVersion: '38674974'
  selfLink: /api/v1/namespaces/spark-on-k8s-native/services/my-spark-zeppelin
  uid: 02ab0265-2330-4b59-a309-b44db068e8b5
spec:
  clusterIP: 10.105.15.90
  externalTrafficPolicy: Cluster
  ports:
    - name: http
      nodePort: 30987
      port: 8080
      protocol: TCP
      targetPort: 8080
    - name: job
      nodePort: 30988
      port: 4040
      protocol: TCP
      targetPort: 4040
  selector:
    component: my-spark-zeppelin
  sessionAffinity: None
  type: LoadBalancer
```