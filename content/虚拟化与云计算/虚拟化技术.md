---
title: "虚拟化技术基础"
layout: page
date: 2099-06-02 00:00
---
[TOC]

# 虚拟化技术基础

## 1. 概况
### 1.1 定义
虚拟化是扩展或替换现有接口以模拟另一个系统的行为。
Virtualization: extend or replace an existing interface to mimic the behavior of another system. 

### 1.2 分类

#### 按照接口类型

##### 1.仿真系统
· 虚拟机 完全模拟硬件
· 虚拟机运行完全未修改的操作系统
— Bochs, VirtualPC for Mac, QEMU • 

##### 2.完整/初级虚拟化
– 虚拟机模拟"足够"的硬件运行未修改的操作系统OS 运行在独立的虚拟硬件上  AVM simulates “enough” hardware to allow an unmodified guest OS to be run in isolation • Same hardware CPU
 案例：IBM VM 系列, VMWare Workstation, Parallels, VirtualBox

##### 3.准虚拟化  para virtualization（PV）
–虚拟机不模拟硬件
–使用修改后的Guster操作系统，必须使用的特殊API
–虚拟机监控程序捕获并提供服务的虚拟化调用
案例：Xen、VMware esx服务器

##### 4. 操作系统级虚拟化

–操作系统允许运行多个安全的虚拟服务器
– 子操作系统与主机操作系统相同，但似乎是孤立的
•应用程序看到独立的操作系统
–Solaris容器、BSD监狱、Linux Vserver、Linux容器、Docker

##### 5.应用程序级虚拟化
–应用程序提供自己的未共享组件的副本
•（例如，自己的注册表文件、全局对象）
-ve防止冲突
–JVM、Mac上的Rosetta（也是模拟）、Wine(在Unix系统下运行Windows的软件)

## 2. 虚拟化是如何实现的

计算虚拟化的本质就是在虚拟系统和底层硬件之间抽象出CPU和内存等，以供虚拟机使用。
对于CPU的虚拟化，我们要了解CPU的几种运行模式。

对于用户态程序和内核态程序分别运行在哪个特权级，下面一张图也给出了说明。

• 虚拟机的内核运行在宿主机的用户态，CPU虚拟化的本质就是实现虚拟机的内核在调用时从用户态切换到内核态。


I/O、更改MMU设置等敏感指令只能在内核模式下执行，在用户模式下执行时导致错误
在硬件辅助全虚拟化条件下，可以执行敏感指令

• Intel 386：忽略用户模式下的敏感指令，不支持硬件辅助全虚拟化

英特尔VT、AMD SVM 支持硬件辅助全虚拟化







