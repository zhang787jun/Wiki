<!DOCTYPE HTML>
<html>

<head>
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <title>[部署]tensorflow_service--模式部署 - Jun's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Wiki" />
    <meta name="description" content="A wiki website" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <script type="text/javascript" async src="https://cdn.bootcss.com/mathjax-mhchem/3.3.2/mhchem.js">
    </script>
    <script>
        function changeImgurl(site_root_url) {
            var images = document.images;
            var site_root = site_root_url;
            for (i = 0, len = images.length; i < len; i++) {
                image = images[i];
                image_src = image.src;
                if (image_src.search("attach") >= 0) {
                    re_image_src = image_src.slice(image_src.search("attach"));
                    abs_image_src = (site_root.endsWith("/")) ? site_root + re_image_src : site_root + "/" +
                        re_image_src;
                    image.src = abs_image_src;
                }
            }
        }
        var site_root_url = "/Wiki";
        changeImgurl(site_root_url);
    </script>

</head>

<body>
    <div id="container">
        
<div id="header">
  <div id="post-nav"><a href="/Wiki/">Home</a>&nbsp;»&nbsp;<a href="/Wiki/#Data_Scince\Library_Platform\Tensorflow">Data_Scince\Library_Platform\Tensorflow</a>&nbsp;»&nbsp;[部署]tensorflow_service--模式部署</div>
</div>
<div class="clearfix"></div>
<div id="title">[部署]tensorflow_service--模式部署</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#tensorflow-service">tensorflow service</a><ul>
<li><a href="#1">1. 安装</a></li>
<li><a href="#2">2. 运行服务</a></li>
<li><a href="#3-model">3. ~/model 中的文件如何生成</a><ul>
<li><a href="#1-dag">1. 模型DAG图的保存</a><ul>
<li><a href="#1-savedmodelbuilder">1. SavedModelBuilder</a></li>
</ul>
</li>
<li><a href="#2-bazel">2. Bazel</a></li>
<li><a href="#3-tfgfilegfile">3. tf.gfile.GFile()</a></li>
<li><a href="#2_1">2. 变量</a></li>
</ul>
</li>
<li><a href="#_1">参考</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="tensorflow-service">tensorflow service</h1>
<h2 id="1">1. 安装</h2>
<p>推荐 docker 安装 </p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">pull</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span>
</pre></div>


<h2 id="2">2. 运行服务</h2>
<ol>
<li>进入docker 命令行</li>
</ol>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8500</span><span class="o">:</span><span class="mi">8500</span> <span class="o">--</span><span class="n">name</span> <span class="n">grpc_name</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">serving</span><span class="o">:</span><span class="n">latest</span><span class="o">-</span><span class="n">devel</span>

<span class="cp"># 8500端口：grpc的端口</span>
<span class="cp"># 8501端口：restful api的端口</span>
<span class="cp"># 上述命令直接进入docker 的命令行</span>
<span class="cp">#[docker]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">ls</span> 
</pre></div>


<ol>
<li>将模型部署到docker中</li>
</ol>
<p>将位于 <code>~/model</code>的文件复制到 名为 <code>grpc_name</code> docker 中的 <code>/online_model</code> 文件夹中 </p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">cp</span> <span class="o">~/</span><span class="n">model</span> <span class="n">grpc</span><span class="o">:/</span><span class="n">online_model</span>
</pre></div>


<p>其中 <code>~/model</code> 中的文件 形如:</p>
<div class="hlcode"><pre><span class="o">~/</span><span class="n">model</span>
<span class="o">|</span><span class="n">__assets</span><span class="o">/</span>
<span class="o">|</span><span class="n">__assets</span><span class="p">.</span><span class="n">extra</span><span class="o">/</span>
<span class="o">|</span><span class="n">__variables</span><span class="o">/</span>
    <span class="o">|</span><span class="n">__variables</span><span class="p">.</span><span class="n">data</span><span class="o">-?????-</span><span class="n">of</span><span class="o">-?????</span>
    <span class="o">|</span><span class="n">__variables</span><span class="p">.</span><span class="n">index</span>
<span class="o">|</span><span class="n">__saved_model</span><span class="p">.</span><span class="n">pb</span>
</pre></div>


<p>主要由以下及部分组成：</p>
<ol>
<li>SavedModel protocol buffe</li>
<li><code>saved_model.pb</code> or <code>saved_model.pbtxt</code></li>
<li>
<p>包括以 MetaGraphDef protocol buffers格式的图的定义。</p>
</li>
<li>
<p>Assets 资源</p>
</li>
<li>一个名为 <code>assets</code> 的子文件夹</li>
<li>包含 词汇表vocabularies 等辅助文件</li>
<li>额外资源 Extra assets</li>
<li>一个名为<code>Extra assets</code> 子文件夹</li>
<li>包括用户需要的自己的包或高级别的库，这些需求并没有在图中加载</li>
<li>This subfolder is not managed by the SavedModel libraries.</li>
<li>变量</li>
<li>一个名为<code>variables</code> 的文件夹</li>
<li>
<p>包含 从TensorFlow Saver 得到的输出 包括：</p>
<ol>
<li>variables.data-?????-of-?????</li>
<li>variables.index</li>
</ol>
</li>
<li>
<p>在服务端开启服务 </p>
</li>
</ol>
<div class="hlcode"><pre><span class="cp"># on [Docker]</span>
<span class="n">tensorflow_model_server</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">8500</span> <span class="o">--</span><span class="n">model_name</span><span class="o">=</span><span class="n">builder</span> <span class="o">--</span><span class="n">model_base_path</span><span class="o">=/</span><span class="n">online_model</span><span class="o">/</span><span class="n">builder</span><span class="o">/</span>
</pre></div>


<h2 id="3-model">3. <code>~/model</code> 中的文件如何生成</h2>
<p><code>~/model</code> 中的文件主要有：<br />
1. 模型DAG图<br />
2. 变量 </p>
<h3 id="1-dag">1. 模型DAG图的保存</h3>
<p>将模型打包后的文件以pb为后缀名，在TensorFlow 中 打包 pb 文件的方法一般有3种。<br />
第一种方法是使用 TensorFlow 官网为我们提供的用于部署模型的类--SavedModeBuilder；<br />
第二种方法是使用谷歌的 Bazel 工具进行模型打包；<br />
第三种方法 是使用 TensorFlow 的 tf.gfile.GFile（）函数打包。</p>
<h4 id="1-savedmodelbuilder">1. SavedModelBuilder</h4>
<div class="hlcode"><pre><span class="n">export_dir</span> <span class="o">=</span> <span class="o">...</span>
<span class="o">...</span>
<span class="c"># 模型构建实例 builder</span>
<span class="n">builder</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">SavedModelBuilder</span><span class="p">(</span><span class="n">export_dir</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">())</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
  <span class="o">...</span>
  <span class="n">builder</span><span class="o">.</span><span class="n">add_meta_graph_and_variables</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">tag_constants</span><span class="o">.</span><span class="n">TRAINING</span><span class="p">],</span>
                                       <span class="n">signature_def_map</span><span class="o">=</span><span class="n">foo_signatures</span><span class="p">,</span>
                                       <span class="n">assets_collection</span><span class="o">=</span><span class="n">foo_assets</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">())</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
  <span class="o">...</span>
  <span class="n">builder</span><span class="o">.</span><span class="n">add_meta_graph</span><span class="p">([</span><span class="s">&quot;bar-tag&quot;</span><span class="p">,</span> <span class="s">&quot;baz-tag&quot;</span><span class="p">])</span>
<span class="o">...</span>
<span class="n">builder</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>


<p>模块说明：<br />
1 . add_meta_graph_and_variables</p>
<div class="hlcode"><pre><span class="n">add_meta_graph_and_variables</span><span class="p">(</span>
    <span class="n">sess</span><span class="p">,</span>
    <span class="n">tags</span><span class="p">,</span><span class="c"># tags:list; tags=[&quot;tag_string&quot;,&quot;..&quot;,...]</span>
    <span class="n">signature_def_map</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c"># signature_def_map:dict{&quot;string_name&quot;:(signature_def)} :{string:tuple}</span>
    <span class="n">assets_collection</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">legacy_init_op</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">clear_devices</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">main_op</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">strip_default_attrs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="c"># 通过 strip_default_attrs=True 确保向前兼容性</span>
    <span class="n">saver</span><span class="o">=</span><span class="bp">None</span>
<span class="p">)</span>
</pre></div>


<ol>
<li>signature_def_map<br />
<code>signature_def_map</code> 定义签名的字典，签名是一组与图有关的输入和输出。</li>
</ol>
<div class="hlcode"><pre><span class="n">signature_def_map</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:(</span><span class="n">SignatureDef</span><span class="p">)}</span>
</pre></div>


<p><code>SignatureDef</code> 是一个协议缓冲区，用于定义图所支持的计算的签名。常用的输入键、输出键和方法名称定义如下<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup><br />
https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/signature_defs.md</p>
<div class="hlcode"><pre><span class="n">signature_def</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_def_utils</span><span class="o">.</span><span class="n">build_signature_def</span><span class="p">(</span>
          <span class="n">inputs</span><span class="o">=</span><span class="p">{</span>
              <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_INPUTS</span><span class="p">:</span>
                  <span class="n">classification_inputs</span>
          <span class="p">},</span>
          <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
              <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_OUTPUT_CLASSES</span><span class="p">:</span>
                  <span class="n">classification_outputs_classes</span><span class="p">,</span>
              <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_OUTPUT_SCORES</span><span class="p">:</span>
                  <span class="n">classification_outputs_scores</span>
          <span class="p">},</span>
          <span class="n">method_name</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_METHOD_NAME</span><span class="p">)</span>
<span class="n">classification_signature</span><span class="o">=</span><span class="p">(</span><span class="n">signature_def</span><span class="p">)</span>

  <span class="c"># Build the signature_def_map.</span>
  <span class="c"># 构建 签名 signature_def_map</span>
  <span class="n">classification_inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span>
      <span class="n">serialized_tf_example</span><span class="p">)</span>
  <span class="n">classification_outputs_classes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span>
      <span class="n">prediction_classes</span><span class="p">)</span>
  <span class="n">classification_outputs_scores</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

  <span class="n">classification_signature</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_def_utils</span><span class="o">.</span><span class="n">build_signature_def</span><span class="p">(</span>
          <span class="n">inputs</span><span class="o">=</span><span class="p">{</span>
              <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_INPUTS</span><span class="p">:</span>
                  <span class="n">classification_inputs</span>
          <span class="p">},</span>
          <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
              <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_OUTPUT_CLASSES</span><span class="p">:</span>
                  <span class="n">classification_outputs_classes</span><span class="p">,</span>
              <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_OUTPUT_SCORES</span><span class="p">:</span>
                  <span class="n">classification_outputs_scores</span>
          <span class="p">},</span>
          <span class="n">method_name</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">CLASSIFY_METHOD_NAME</span><span class="p">))</span>

  <span class="n">tensor_info_x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">tensor_info_y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="n">prediction_signature</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_def_utils</span><span class="o">.</span><span class="n">build_signature_def</span><span class="p">(</span>
          <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;images&#39;</span><span class="p">:</span> <span class="n">tensor_info_x</span><span class="p">},</span>
          <span class="n">outputs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;scores&#39;</span><span class="p">:</span> <span class="n">tensor_info_y</span><span class="p">},</span>
          <span class="n">method_name</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">PREDICT_METHOD_NAME</span><span class="p">))</span>

  <span class="n">legacy_init_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">tables_initializer</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;legacy_init_op&#39;</span><span class="p">)</span>

  <span class="n">builder</span><span class="o">.</span><span class="n">add_meta_graph_and_variables</span><span class="p">(</span>
      <span class="n">sess</span><span class="p">,</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">tag_constants</span><span class="o">.</span><span class="n">SERVING</span><span class="p">],</span>
      <span class="n">signature_def_map</span><span class="o">=</span><span class="p">{</span>
          <span class="s">&#39;predict_images&#39;</span><span class="p">:</span>
              <span class="n">prediction_signature</span><span class="p">,</span>
          <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">DEFAULT_SERVING_SIGNATURE_DEF_KEY</span><span class="p">:</span>
              <span class="n">classification_signature</span><span class="p">,</span>
      <span class="p">},</span>
  <span class="n">legacy_init_op</span><span class="o">=</span><span class="n">legacy_init_op</span><span class="p">)</span>

  <span class="n">builder</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_def_utils</span><span class="o">.</span><span class="n">build_signature_def</span><span class="p">()</span>
</pre></div>


<p>值得注意的是在导出模型的时候， 必须将保存导出模型的目录<code>export_dir</code>设置为空目录， 否则会出现一个该目录巳存在的错误 ， 所以，在设置 <code>export_dir</code> 值的时候，务必要保证里面没离任何数据。</p>
<p>模型被保存后，会在保存模型的目录中生成一个saved_rnodel.pb文件和一个 variables 文件夹。 其中 saved_model.pb 文件就是我仍保存下来的模型文件，也是之后我们要发布时所使用的文件； variables 文件夹里存放的就是与模型相关的一系列参数。 <br />
这两部分会被存到一 个自定义的模型目录下当发布模型时需要对整个文件夹进行操作。</p>
<p>MetaGraph 是一种数据流图，并包含相关变量、资源和签名。MetaGraphDef 是 MetaGraph 的协议缓冲区表示法。</p>
<div class="hlcode"><pre><span class="n">export_dir</span> <span class="o">=</span> <span class="o">...</span>
<span class="o">...</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">())</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="p">[</span><span class="n">tag_constants</span><span class="o">.</span><span class="n">TRAINING</span><span class="p">],</span> <span class="n">export_dir</span><span class="p">)</span>
  <span class="o">...</span>
</pre></div>


<h3 id="2-bazel">2. Bazel</h3>
<p>要使用 TensorFlow Serving 部署模型 ， 则需要一个必备工具一－Bazel 。 Bazel 是 一个类似于 Maven 相 Google 的开源构建和测试工具，<br />
支持多种语言的项目并且可 以为多个平台构建和输出可以直接从 Bazel的官方网站上下载最新版本，并使用如下命令进行安装。</p>
<div class="hlcode"><pre><span class="n">bazel</span> <span class="n">build</span> <span class="o">-</span> <span class="n">c</span> <span class="n">opt</span> <span class="c1">//tensorflow serving / example: mnist_saved_model</span>
<span class="n">bazel</span><span class="o">-</span><span class="n">bin</span> <span class="o">/</span> <span class="n">tensorflow_serving</span> <span class="o">/</span> <span class="n">example</span> <span class="o">/</span> <span class="n">mnist_saved_model</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">mnist_model</span> 
</pre></div>


<p>第一行的意思是将我们的训练源码进行构建，也就是训练模型的过程；<br />
第二行的意思则是将训练好的 TensorFlow 打包成一个模型文 件 3 打包后同样生成 saved_model.pb 文件和 variables 艾件夹。<br />
虽然使用 Bazel 打包是谷歌官方推荐的 ， 但是在实际生产过程中并不常用 </p>
<h3 id="3-tfgfilegfile">3. tf.gfile.GFile()</h3>
<p>tf.gfile 是tensorflow 的文件操作库 </p>
<p>```python<br />
import tensorflow as tf<br />
from tensorflow.python . framework import graph_util </p>
<p>from tensorflow .python .platform import gfile </p>
<p>if name =="main":<br />
    a=tf.Variable(tf. constant(S. , shape=(l ]) , name=”a " )<br />
    b=tf.Variable (tf. constant(6., shape= (l]), n缸ne＝”b ") <br />
    c = a + b <br />
    init = tf.initialze_allvariables() <br />
    sess=tf.Session()<br />
    sess.run(init)<br />
    #导出当前计算图的 GraphDef 部分<br />
    graph_def = tf. get_default_graph().as_graph_def()</p>
<div class="hlcode"><pre><span class="cp">#保干字指定的节点，并将节点（直保存为常数 </span>
<span class="n">output_graph_def</span><span class="o">=</span><span class="n">graph_util</span><span class="p">.</span><span class="n">convert_variables_to_constants</span> <span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">graph_def</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;add&quot;</span><span class="p">]</span><span class="err">）</span> 
<span class="cp">#将计算圄写入至文件中 </span>
<span class="n">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">gfile</span><span class="p">.</span><span class="n">GFile</span> <span class="p">(</span><span class="s">&quot;models.pb&quot;</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="n">f</span> <span class="o">:</span> 
  <span class="n">f</span><span class="p">.</span><span class="n">write</span> <span class="p">(</span><span class="n">output_graph_def</span><span class="p">.</span> <span class="n">SerializeToString</span> <span class="p">()</span> <span class="p">)</span>
</pre></div>


<p>````<br />
上面一段代码就是使用 tf.gfile.GFile（）函数打包 ， 将图的信息进行保存然后写入 pb 文件中 。</p>
<h3 id="2_1">2. 变量</h3>
<p>通过 TensorFlow Saver 得到的输出 </p>
<p>1<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></p>
<h2 id="_1">参考</h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/README.md&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</div>
<div id="re">
  如果你觉得这篇文章对你有帮助，不妨请我喝杯咖啡，鼓励我创造更多
</div>>

    </div>
    <div id="footer">
        <span>
            Copyright © 2019 zhang787jun.
            Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        </span>
    </div>
    
</body>

</html>