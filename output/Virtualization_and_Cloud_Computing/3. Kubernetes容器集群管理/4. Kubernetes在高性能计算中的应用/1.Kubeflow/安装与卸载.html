<!DOCTYPE HTML>
<html>

<head>
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/Wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Wiki/favicon.ico" type="image/x-icon">
    <title>Kubeflow--安装与卸载 - Jun's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, MachineLearning, DataMining, Wiki" />
    <meta name="description" content="A wiki website" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            }
        });
    </script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
</head>

<body>

    <div id="container">
        
<div id="header">
  <div id="post-nav"><a href="/Wiki/">Home</a>&nbsp;»&nbsp;<a href="/Wiki/#Virtualization_and_Cloud_Computing">Virtualization_and_Cloud_Computing</a>&nbsp;»&nbsp;<a href="/Wiki/#-3. Kubernetes容器集群管理">3. Kubernetes容器集群管理</a>&nbsp;»&nbsp;<a href="/Wiki/#-4. Kubernetes在高性能计算中的应用">4. Kubernetes在高性能计算中的应用</a>&nbsp;»&nbsp;<a href="/Wiki/#-1.Kubeflow">1.Kubeflow</a>&nbsp;»&nbsp;Kubeflow--安装与卸载</div>
</div>
<div class="clearfix"></div>
<div id="title">Kubeflow--安装与卸载</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#1">1. 安装</a><ul>
<li><a href="#11">1.1. 最低系统要求</a></li>
<li><a href="#12-10">1.2. 实践1.0版本</a><ul>
<li><a href="#121-kfctl">1.2.1. 安装kfctl</a></li>
<li><a href="#122">1.2.2. 获得配置文件</a></li>
<li><a href="#123">1.2.3. 配置存储</a></li>
<li><a href="#124">1.2.4. 安装</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2">2. 运维与查看</a></li>
<li><a href="#3">3. 卸载</a></li>
<li><a href="#4">4. 问题</a></li>
<li><a href="#5">5. 使用</a><ul>
<li><a href="#51">5.1. 验证部署</a></li>
</ul>
</li>
<li><a href="#6-spawner">6. Spawner</a></li>
<li><a href="#7-kubeflow-ui">7. Kubeflow UI</a></li>
<li><a href="#8">8.</a></li>
<li><a href="#9">9.</a></li>
<li><a href="#10-kfctl_k8s_istioyaml">10. 详细解读 kfctl_k8s_istio.yaml</a><ul>
<li><a href="#1001">10.0.1. 配置存储卷</a></li>
<li><a href="#1002-kfctl">10.0.2. kfctl 安装</a></li>
</ul>
</li>
<li><a href="#11_1">11. 参考资料</a></li>
</ul>
</div>
<h1 id="1">1. 安装</h1>
<p><strong>在现有kebernetes群集上的部署概述</strong></p>
<h2 id="11">1.1. 最低系统要求</h2>
<p>Kubernetes集群必须满足以下最低要求：<br />
您的集群必须至少包含<strong>1个工作节点</strong>(Work node)，且最少为：<br />
1. <strong>4个CPU</strong><br />
2. <strong>50 GB的存储空间</strong><br />
3. <strong>12 GB内存</strong></p>
<h2 id="12-10">1.2. 实践1.0版本</h2>
<p>使用kfctl安装kubeflow</p>
<h3 id="121-kfctl">1.2.1. 安装kfctl</h3>
<p><code>kfctl</code> is the executable binary file that you use to deploy Kubeflow.<br />
<code>kfctl</code> 是用于部署Kubeflow的可执行文件，通过ctl实现.</p>
<div class="hlcode"><pre><span class="cp"># 1. 安装kfctl</span>
<span class="n">wget</span> <span class="n">http</span><span class="o">:</span><span class="c1">//kubeflow.oss-cn-beijing.aliyuncs.com/kfctl_v1.0-0-g94c35cf_linux.tar.gz</span>
<span class="n">tar</span> <span class="n">zxvf</span> <span class="n">kfctl_v1</span><span class="mf">.0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="n">g94c35cf_linux</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="n">sudo</span> <span class="n">mv</span> <span class="n">kfctl</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>

<span class="cp"># 验证</span>
<span class="n">kfctl</span> <span class="n">version</span>
</pre></div>


<h3 id="122">1.2.2. 获得配置文件</h3>
<p><code>kfctl_k8s_istio.yaml</code> 是Kubeflow官方的的配置文件（社区版），此配置使用其所有核心组件创建了Kubeflow的原始部署，而没有任何外部依赖性。可以根据您的环境需求自定义部署。</p>
<div class="hlcode"><pre># 2. 通过kfctl生成应用的配置文件
export KF_NAME=my-kubeflow-2
export BASE_DIR=/home
export KF_DIR=<span class="cp">${</span><span class="n">BASE_DIR</span><span class="cp">}</span>/<span class="cp">${</span><span class="n">KF_NAME</span><span class="cp">}</span>
export CONFIG_URI=&quot;http://kubeflow.oss-cn-beijing.aliyuncs.com/kfctl_k8s_istio.v1.0.1.yaml&quot;
sudo mkdir -p <span class="cp">${</span><span class="n">KF_DIR</span><span class="cp">}</span>
sudo chmod -R 777 <span class="cp">${</span><span class="n">KF_DIR</span><span class="cp">}</span>
cd <span class="cp">${</span><span class="n">KF_DIR</span><span class="cp">}</span>
</pre></div>


<h3 id="123">1.2.3. 配置存储</h3>
<div class="hlcode"><pre><span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">local_pv</span><span class="p">.</span><span class="n">yaml</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">pipeline</span><span class="o">-</span><span class="n">mysql</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="o">---</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">minio</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">minio</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">pipeline</span><span class="o">-</span><span class="n">minio</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="o">---</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">katib</span><span class="o">-</span><span class="n">mysql</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">katib</span><span class="o">-</span><span class="n">mysql</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">katib</span><span class="o">-</span><span class="n">mysql</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="o">---</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">metadata</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">metadata</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">metadata</span><span class="o">-</span><span class="n">mysql</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="n">EOF</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="o">-</span><span class="n">f</span> <span class="n">local_pv</span><span class="p">.</span><span class="n">yaml</span>
</pre></div>


<h3 id="124">1.2.4. 安装</h3>
<div class="hlcode"><pre>kfctl apply -V -f <span class="cp">${</span><span class="n">CONFIG_URI</span><span class="cp">}</span>
</pre></div>


<h1 id="2">2. 运维与查看</h1>
<div class="hlcode"><pre><span class="n">kubectl</span> <span class="n">create</span> <span class="o">-</span><span class="n">f</span> <span class="n">workspace</span><span class="o">-</span><span class="n">pv</span><span class="p">.</span><span class="n">yaml</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">workspace</span><span class="o">-</span><span class="n">fish</span>
  <span class="nl">namespace:</span> <span class="n">fish</span>
<span class="nl">spec:</span>
  <span class="nl">storageClassName:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">nfs</span><span class="o">-</span><span class="n">storage</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">10</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">nfs:</span>
    <span class="nl">server:</span> <span class="mf">192.168.1.100</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">ssd</span><span class="o">/</span><span class="n">nfsdata</span><span class="o">/</span><span class="n">k8s</span><span class="o">/</span><span class="n">defstor</span>
</pre></div>


<h1 id="3">3. 卸载</h1>
<div class="hlcode"><pre># If you want to delete all the resources, including storage:
kfctl delete -f <span class="cp">${</span><span class="n">CONFIG_FILE</span><span class="cp">}</span> --delete_storage

# If you want to preserve storage, which contains metadata and information
# from Kubeflow Pipelines:
kfctl delete -f <span class="cp">${</span><span class="n">CONFIG_FILE</span><span class="cp">}</span>
</pre></div>


<h1 id="4">4. 问题</h1>
<div class="hlcode"><pre><span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">profile</span><span class="p">.</span><span class="n">yaml</span>
<span class="nl">apiVersion:</span> <span class="n">kubeflow</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="nl">kind:</span> <span class="n">Profile</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">haha</span>
<span class="nl">spec:</span>
  <span class="nl">owner:</span>
    <span class="nl">kind:</span> <span class="n">User</span>
    <span class="nl">name:</span> <span class="n">userid</span><span class="err">@</span><span class="n">email</span><span class="p">.</span><span class="n">com</span>   <span class="err">#</span> <span class="n">replace</span> <span class="n">with</span> <span class="n">the</span> <span class="n">email</span> <span class="n">of</span> <span class="n">the</span> <span class="n">user</span>

  <span class="nl">resourceQuotaSpec:</span>    <span class="err">#</span> <span class="n">resource</span> <span class="n">quota</span> <span class="n">can</span> <span class="n">be</span> <span class="n">set</span> <span class="n">optionally</span>
   <span class="nl">hard:</span>
     <span class="nl">cpu:</span> <span class="s">&quot;2&quot;</span>
     <span class="nl">memory:</span> <span class="mi">2</span><span class="n">Gi</span>
     <span class="n">requests</span><span class="p">.</span><span class="n">nvidia</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">gpu</span><span class="o">:</span> <span class="s">&quot;1&quot;</span>
     <span class="nl">persistentvolumeclaims:</span> <span class="s">&quot;1&quot;</span>
     <span class="n">requests</span><span class="p">.</span><span class="n">storage</span><span class="o">:</span> <span class="s">&quot;5Gi&quot;</span>
<span class="n">EOF</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="o">-</span><span class="n">f</span> <span class="n">profile</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">profile</span><span class="p">.</span><span class="n">yaml</span>  <span class="err">#</span><span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">modifying</span> <span class="n">the</span> <span class="n">profile</span>
</pre></div>


<h1 id="5">5. 使用</h1>
<h2 id="51">5.1. 验证部署</h2>
<p>查看相关的Pod是否处于Running状态</p>
<div class="hlcode"><pre><span class="n">kubectl</span> <span class="n">get</span> <span class="n">service</span> <span class="n">tf</span><span class="o">-</span><span class="n">hub</span><span class="o">-</span><span class="n">lb</span>  <span class="o">-</span><span class="n">n</span> <span class="n">kubeflow</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">NAME</span>        <span class="n">TYPE</span>           <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>       <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="n">AGE</span>
<span class="n">tf</span><span class="o">-</span><span class="n">hub</span><span class="o">-</span><span class="n">lb</span>   <span class="n">LoadBalancer</span>   <span class="mf">10.109.167.223</span>   <span class="mf">172.16.3.4</span>    <span class="mi">8000</span><span class="o">:</span><span class="mi">30962</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">34</span><span class="n">m</span>

<span class="n">kubectl</span> <span class="n">get</span> <span class="n">po</span> <span class="o">-</span><span class="n">n</span> <span class="n">kubeflow</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">NAME</span>                                <span class="n">READY</span>     <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">ambassador</span><span class="o">-</span><span class="mf">58f</span><span class="mi">64</span><span class="n">cb77</span><span class="o">-</span><span class="mi">9</span><span class="n">cqq2</span>          <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>
<span class="n">ambassador</span><span class="o">-</span><span class="mf">58f</span><span class="mi">64</span><span class="n">cb77</span><span class="o">-</span><span class="n">fqn8x</span>          <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>
<span class="n">ambassador</span><span class="o">-</span><span class="mf">58f</span><span class="mi">64</span><span class="n">cb77</span><span class="o">-</span><span class="n">g8pb6</span>          <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>
<span class="n">centraldashboard</span><span class="o">-</span><span class="mi">648</span><span class="n">d5f56d9</span><span class="o">-</span><span class="n">xp9c8</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>
<span class="n">tf</span><span class="o">-</span><span class="n">hub</span><span class="o">-</span><span class="mi">0</span>                            <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>
<span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">dashboard</span><span class="o">-</span><span class="mi">759</span><span class="n">c7d4dd</span><span class="o">-</span><span class="mi">6</span><span class="n">mj2j</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>
<span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">operator</span><span class="o">-</span><span class="mi">7684</span><span class="n">bcf66b</span><span class="o">-</span><span class="n">qqvt8</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>       <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">h</span>


<span class="n">kubectl</span> <span class="n">proxy</span> <span class="o">&amp;</span> <span class="n">kubectl</span> <span class="n">get</span> <span class="n">namespace</span> <span class="err">$</span><span class="n">NAMESPACE</span> <span class="o">-</span><span class="n">o</span> <span class="n">json</span> <span class="o">|</span><span class="n">jq</span> <span class="err">&#39;</span><span class="p">.</span><span class="n">spec</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;finalizers&quot;</span><span class="o">:</span><span class="p">[]}</span><span class="err">&#39;</span> <span class="o">&gt;</span><span class="n">temp</span><span class="p">.</span><span class="n">json</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">k</span> <span class="o">-</span><span class="n">H</span> <span class="s">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="err">@</span><span class="n">temp</span><span class="p">.</span><span class="n">json</span> <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">8001</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">namespaces</span><span class="o">/</span><span class="err">$</span><span class="n">NAMESPACE</span><span class="o">/</span><span class="n">finalize</span>
</pre></div>


<h1 id="6-spawner">6. Spawner</h1>
<p>https://jupyterhub.readthedocs.io/en/stable/reference/spawners.html</p>
<h1 id="7-kubeflow-ui">7. Kubeflow UI</h1>
<p>查看Service中，可以看到kubeflow中，附附带了许多Web UI:</p>
<ol>
<li>Argo UI</li>
<li>Central UI for navigation</li>
<li>JupyterHub</li>
<li>Katib</li>
<li>TFJobs Dashboard</li>
</ol>
<h1 id="8">8.</h1>
<div class="hlcode"><pre><span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">notebook_pv</span><span class="p">.</span><span class="n">yaml</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">notebook</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">mynamespaes</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">notebook</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">10</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">notebook</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
</pre></div>


<h1 id="9">9.</h1>
<h1 id="10-kfctl_k8s_istioyaml">10. 详细解读 kfctl_k8s_istio.yaml</h1>
<p><code>kfctl_k8s_istio.yaml</code>中包括44个applications（应用），每个应用通过<br />
kustomizeConfig部署</p>
<div class="hlcode"><pre><span class="n">apiVersion</span><span class="o">:</span> <span class="n">kfdef</span><span class="o">.</span><span class="na">apps</span><span class="o">.</span><span class="na">kubeflow</span><span class="o">.</span><span class="na">org</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">KfDef</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="kd">namespace</span><span class="o">:</span> <span class="n">kubeflow</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">applications</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">system</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">istio</span><span class="o">/</span><span class="n">istio</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">system</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">istio</span><span class="o">/</span><span class="n">istio</span><span class="o">-</span><span class="n">install</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">install</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">system</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">istio</span><span class="o">/</span><span class="n">cluster</span><span class="o">-</span><span class="n">local</span><span class="o">-</span><span class="n">gateway</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">cluster</span><span class="o">-</span><span class="n">local</span><span class="o">-</span><span class="n">gateway</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">system</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">istio</span><span class="o">/</span><span class="n">kfserving</span><span class="o">-</span><span class="n">gateway</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">kfserving</span><span class="o">-</span><span class="n">gateway</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">clusterRbacConfig</span>
        <span class="n">value</span><span class="o">:</span> <span class="s1">&#39;OFF&#39;</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">istio</span><span class="o">/</span><span class="n">istio</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">istio</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">system</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">istio</span><span class="o">/</span><span class="n">add</span><span class="o">-</span><span class="n">anonymous</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">filter</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">add</span><span class="o">-</span><span class="n">anonymous</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">filter</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">application</span><span class="o">/</span><span class="n">application</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">application</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">application</span><span class="o">/</span><span class="n">application</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">application</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">resources</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">resources</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">self</span><span class="o">-</span><span class="n">signed</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">metacontroller</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">metacontroller</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">argo</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">argo</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">roles</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">roles</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">common</span><span class="o">/</span><span class="n">centraldashboard</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">centraldashboard</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">admission</span><span class="o">-</span><span class="n">webhook</span><span class="o">/</span><span class="n">bootstrap</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">bootstrap</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">admission</span><span class="o">-</span><span class="n">webhook</span><span class="o">/</span><span class="n">webhook</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">webhook</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">userid</span><span class="o">-</span><span class="n">header</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">userid</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">jupyter</span><span class="o">/</span><span class="n">jupyter</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">app</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">jupyter</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">app</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">spark</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">operator</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">spark</span><span class="o">-</span><span class="n">operator</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="o">-</span> <span class="n">db</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">metadata</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">metadata</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">jupyter</span><span class="o">/</span><span class="n">notebook</span><span class="o">-</span><span class="n">controller</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">notebook</span><span class="o">-</span><span class="n">controller</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pytorch</span><span class="o">-</span><span class="n">job</span><span class="o">/</span><span class="n">pytorch</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">pytorch</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pytorch</span><span class="o">-</span><span class="n">job</span><span class="o">/</span><span class="n">pytorch</span><span class="o">-</span><span class="n">operator</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">pytorch</span><span class="o">-</span><span class="n">operator</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">knative</span><span class="o">-</span><span class="n">serving</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">knative</span><span class="o">/</span><span class="n">knative</span><span class="o">-</span><span class="n">serving</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">knative</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="kd">namespace</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">knative</span><span class="o">-</span><span class="n">serving</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">knative</span><span class="o">/</span><span class="n">knative</span><span class="o">-</span><span class="n">serving</span><span class="o">-</span><span class="n">install</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">knative</span><span class="o">-</span><span class="n">install</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">kfserving</span><span class="o">/</span><span class="n">kfserving</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">kfserving</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">kfserving</span><span class="o">/</span><span class="n">kfserving</span><span class="o">-</span><span class="n">install</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">kfserving</span><span class="o">-</span><span class="n">install</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">usageId</span>
        <span class="n">value</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">randomly</span><span class="o">-</span><span class="n">generated</span><span class="o">-</span><span class="n">id</span><span class="o">&gt;</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">reportUsage</span>
        <span class="n">value</span><span class="o">:</span> <span class="s1">&#39;true&#39;</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">common</span><span class="o">/</span><span class="n">spartakus</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">spartakus</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">tensorboard</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">tensorboard</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">tf</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">tf</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">operator</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">operator</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">katib</span><span class="o">/</span><span class="n">katib</span><span class="o">-</span><span class="n">crds</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">katib</span><span class="o">-</span><span class="n">crds</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">katib</span><span class="o">/</span><span class="n">katib</span><span class="o">-</span><span class="n">controller</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">katib</span><span class="o">-</span><span class="n">controller</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">api</span><span class="o">-</span><span class="n">service</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">api</span><span class="o">-</span><span class="n">service</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">minioPvcName</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">minio</span><span class="o">-</span><span class="n">pv</span><span class="o">-</span><span class="n">claim</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">minio</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">minio</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">mysqlPvcName</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">mysql</span><span class="o">-</span><span class="n">pv</span><span class="o">-</span><span class="n">claim</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">mysql</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">mysql</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">persistent</span><span class="o">-</span><span class="n">agent</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">persistent</span><span class="o">-</span><span class="n">agent</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">pipelines</span><span class="o">-</span><span class="n">runner</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">pipelines</span><span class="o">-</span><span class="n">runner</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">pipelines</span><span class="o">-</span><span class="n">ui</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">pipelines</span><span class="o">-</span><span class="n">ui</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">pipelines</span><span class="o">-</span><span class="n">viewer</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">pipelines</span><span class="o">-</span><span class="n">viewer</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">scheduledworkflow</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">scheduledworkflow</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">/</span><span class="n">pipeline</span><span class="o">-</span><span class="n">visualization</span><span class="o">-</span><span class="n">service</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">visualization</span><span class="o">-</span><span class="n">service</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="o">-</span> <span class="n">istio</span>
      <span class="n">parameters</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">admin</span>
        <span class="n">value</span><span class="o">:</span> <span class="n">johnDoe</span><span class="err">@</span><span class="n">acme</span><span class="o">.</span><span class="na">com</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">profiles</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">profiles</span>
  <span class="o">-</span> <span class="n">kustomizeConfig</span><span class="o">:</span>
      <span class="n">overlays</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">application</span>
      <span class="n">repoRef</span><span class="o">:</span>
        <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
        <span class="n">path</span><span class="o">:</span> <span class="n">seldon</span><span class="o">/</span><span class="n">seldon</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">operator</span>
    <span class="n">name</span><span class="o">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">operator</span>
  <span class="n">repos</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">manifests</span>
    <span class="n">uri</span><span class="o">:</span> <span class="n">https</span><span class="o">://</span><span class="n">github</span><span class="o">.</span><span class="na">com</span><span class="sr">/kubeflow/manifests/archive/</span><span class="n">v1</span><span class="o">.</span><span class="mf">0.2</span><span class="o">.</span><span class="na">tar</span><span class="o">.</span><span class="na">gz</span>
  <span class="n">version</span><span class="o">:</span> <span class="n">v1</span><span class="o">.</span><span class="mf">0.2</span>
</pre></div>


<h3 id="1001">10.0.1. 配置存储卷</h3>
<p>KubeFlow依赖于<br />
1. katib-mysql<br />
2. pipeline-mino<br />
3. pipeline-mysql<br />
这三个有状态服务，而这些需要提前部署，您也可以根据自己的需求修改PV和PVC的配置</p>
<div class="hlcode"><pre><span class="cp"># 3. 设置存储机制</span>
<span class="cp">## 参考使用hostPath卷创建PV，并声明PVC </span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">local_pv</span><span class="p">.</span><span class="n">yaml</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">pipeline</span><span class="o">-</span><span class="n">mysql</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="o">---</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">minio</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">pipeline</span><span class="o">-</span><span class="n">minio</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">pipeline</span><span class="o">-</span><span class="n">minio</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="o">---</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">katib</span><span class="o">-</span><span class="n">mysql</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">katib</span><span class="o">-</span><span class="n">mysql</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">katib</span><span class="o">-</span><span class="n">mysql</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="o">---</span>
<span class="nl">apiVersion:</span> <span class="n">v1</span>
<span class="nl">kind:</span> <span class="n">PersistentVolume</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="n">metadata</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
  <span class="nl">namespace:</span> <span class="n">kubeflow</span>
  <span class="nl">labels:</span>
    <span class="nl">type:</span> <span class="n">local</span>
    <span class="nl">app:</span> <span class="n">metadata</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span>
    <span class="nl">key:</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">pv</span>
<span class="nl">spec:</span>
  <span class="nl">capacity:</span>
    <span class="nl">storage:</span> <span class="mi">20</span><span class="n">Gi</span>
  <span class="nl">accessModes:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="nl">hostPath:</span>
    <span class="nl">path:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">metadata</span><span class="o">-</span><span class="n">mysql</span>
    <span class="nl">type:</span> <span class="n">DirectoryOrCreate</span>
<span class="n">EOF</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="o">-</span><span class="n">f</span> <span class="n">local_pv</span><span class="p">.</span><span class="n">yaml</span>
</pre></div>


<h3 id="1002-kfctl">10.0.2. kfctl 安装</h3>
<div class="hlcode"><pre>kfctl apply -V -f <span class="cp">${</span><span class="n">CONFIG_URI</span><span class="cp">}</span>
export CONFIG=<span class="cp">${</span><span class="n">KF_DIR</span><span class="cp">}</span>/kfctl_k8s_istio.v1.0.1.yaml
</pre></div>


<p><strong>问题1</strong>：安装的时候，一班需要多次运行kfctl apply命令出现如下问题</p>
<div class="hlcode"><pre><span class="n">WARN</span><span class="p">[</span><span class="mo">05</span><span class="mi">98</span><span class="p">]</span> <span class="n">Encountered</span> <span class="n">error</span> <span class="n">applying</span> <span class="n">application</span> <span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span><span class="o">:</span>  <span class="p">(</span><span class="n">kubeflow</span><span class="p">.</span><span class="n">error</span><span class="p">)</span><span class="o">:</span> <span class="n">Code</span> <span class="mi">500</span> <span class="n">with</span> <span class="n">message</span><span class="o">:</span> <span class="n">Apply</span><span class="p">.</span><span class="n">Run</span>  <span class="n">Error</span> <span class="n">error</span> <span class="n">when</span> <span class="n">applying</span> <span class="n">patch</span><span class="o">:</span>
<span class="p">............</span>
<span class="nl">for:</span> <span class="s">&quot;/tmp/kout686424655&quot;</span><span class="o">:</span> <span class="n">CustomResourceDefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="s">&quot;tfjobs.kubeflow.org&quot;</span> <span class="n">is</span> <span class="n">invalid</span><span class="o">:</span> <span class="p">[</span><span class="n">spec</span><span class="p">.</span><span class="n">version</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">value</span><span class="o">:</span> <span class="s">&quot;v1beta1&quot;</span><span class="o">:</span> <span class="n">must</span> <span class="n">match</span> <span class="n">the</span> <span class="n">first</span> <span class="n">version</span> <span class="n">in</span> <span class="n">spec</span><span class="p">.</span><span class="n">versions</span><span class="p">,</span> <span class="n">status</span><span class="p">.</span><span class="n">storedVersions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">value</span><span class="o">:</span> <span class="s">&quot;v1beta1&quot;</span><span class="o">:</span> <span class="n">must</span> <span class="n">appear</span> <span class="n">in</span> <span class="n">spec</span><span class="p">.</span><span class="n">versions</span><span class="p">]</span>
</pre></div>


<p>我是通过先执行删除命令，之后又重新安装就可以了</p>
<div class="hlcode"><pre><span class="n">kubectl</span> <span class="n">kustomize</span>  <span class="n">kustomize</span><span class="o">/</span><span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span><span class="o">/</span> <span class="o">|</span> <span class="n">kubectl</span> <span class="n">delete</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span>
<span class="n">kubectl</span> <span class="n">kustomize</span>  <span class="n">kustomize</span><span class="o">/</span><span class="n">tf</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">crds</span><span class="o">/</span> <span class="o">|</span> <span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span>
</pre></div>


<div class="hlcode"><pre><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">mutatingwebhookconfiguration</span> <span class="n">inferenceservice</span><span class="p">.</span><span class="n">serving</span><span class="p">.</span><span class="n">kubeflow</span><span class="p">.</span><span class="n">org</span> <span class="o">--</span><span class="n">patch</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&quot;webhooks&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;inferenceservice.kfserving-webhook-server.pod-mutator&quot;</span><span class="p">,</span><span class="s">&quot;objectSelector&quot;</span><span class="o">:</span><span class="p">{</span><span class="s">&quot;matchExpressions&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s">&quot;key&quot;</span><span class="o">:</span><span class="s">&quot;serving.kubeflow.org/inferenceservice&quot;</span><span class="p">,</span> <span class="s">&quot;operator&quot;</span><span class="o">:</span> <span class="s">&quot;Exists&quot;</span><span class="p">}]}}]}</span><span class="err">&#39;</span>
</pre></div>


<div class="hlcode"><pre><span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">istio</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">health</span><span class="p">.</span><span class="n">yaml</span>
<span class="nl">apiVersion:</span> <span class="n">security</span><span class="p">.</span><span class="n">istio</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="nl">kind:</span> <span class="n">PeerAuthentication</span>
<span class="nl">metadata:</span>
  <span class="nl">name:</span> <span class="s">&quot;default&quot;</span>
  <span class="nl">namespace:</span> <span class="s">&quot;istio-io-health&quot;</span>
<span class="nl">spec:</span>
  <span class="nl">mtls:</span>
    <span class="nl">mode:</span> <span class="n">STRICT</span>
<span class="n">EOF</span>
<span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">istio</span><span class="o">-</span><span class="n">io</span><span class="o">-</span><span class="n">health</span><span class="p">.</span><span class="n">yaml</span>
</pre></div>


<h1 id="11_1">11. 参考资料</h1>
<p>1.<a href="https://developer.aliyun.com/article/758776">阿里云Kubeflow 1.0 上线： 体验生产级的机器学习平台<br />
</a><br />
2. </p>
</div>
<div id="renote">
  <HR style=" FILTER: alpha (opacity = 100, finishopacity =0 , style= 3 )" width="80%" color=#987 cb 9 SIZE=3>
  <p>如果你觉得这篇文章对你有帮助，不妨请我喝杯咖啡，鼓励我创造更多!</p>
  <img src="/Wiki/static/images/pay.jpg" width="25%">
</div>

    </div>
    <div id="footer">
        <span>
            Copyright © 2021 zhang787jun.
            Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        </span>
    </div>

    
</body>
<script>
    function changeImgurl(site_root_url) {
        var images = document.images;
        var site_root = site_root_url;
        for (i = 0, len = images.length; i < len; i++) {
            image = images[i];
            image_src = image.src;
            if (image_src.search("attach") >= 0) {
                re_image_src = image_src.slice(image_src.search("attach"));
                abs_image_src = (site_root.endsWith("/")) ? site_root + re_image_src : site_root + "/" +
                    re_image_src;
                image.src = abs_image_src;
            }
        }
    }
    var site_root_url = "/Wiki";
    changeImgurl(site_root_url);
    let isMathjaxConfig = false; // 防止重复调用Config，造成性能损耗
    const initMathjaxConfig = () => {
        if (!window.MathJax) {
            return;
        }
        window.MathJax.Hub.Config({
            showProcessingMessages: false, //关闭js加载过程信息
            messageStyle: "none", //不显示信息
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
                displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
            },
            "HTML-CSS": {
                availableFonts: ["STIX", "TeX"], //可选字体
                showMathMenu: false //关闭右击菜单显示
            }
        });
        isMathjaxConfig = true; //
    };
    if (isMathjaxConfig === false) {
        // 如果：没有配置MathJax
        initMathjaxConfig();
    };
</script>

</html>